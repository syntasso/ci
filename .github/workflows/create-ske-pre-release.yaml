name: Create SKE Pre-release

on:
  workflow_dispatch:

jobs:
  create-pre-release:
    runs-on: ubuntu-latest
    steps:
      - name: Check out enterprise kratix
        uses: actions/checkout@v4
        with:
          repository: syntasso/enterprise-kratix
          ssh-key: ${{ secrets.ENTERPRISE_KRATIX_DEPLOY_KEY_READ_PUSH }}
          ref: ${{ github.event.inputs.ske_sha }}
          submodules: recursive
      - name: Generate changelog
        run: |
          git fetch --tags
          LATEST_RELEASE_TAG=v0.28.0-rc3 ./scripts/generate-changelog
          changelog=$(cat final-changelog.md)
          echo "$changelog" >> "$GITHUB_STEP_SUMMARY"
        env:
          GH_TOKEN: ${{ secrets.ENTERPRISE_KRATIX_GH_TOKEN }}
