name: Create SKE Pre-release

on:
  workflow_dispatch:

jobs:
  create-pre-release:
    runs-on: ubuntu-latest
    steps:
      - name: Check out enterprise kratix
        uses: actions/checkout@v4
        with:
          repository: syntasso/enterprise-kratix
          ssh-key: ${{ secrets.ENTERPRISE_KRATIX_DEPLOY_KEY_READ_PUSH }}
          ref: ${{ github.event.inputs.ske_sha }}
          submodules: recursive
      - name: Install Helm
        uses: azure/setup-helm@v3
      - name: Login to ghcr
        run: |
          echo "${{ secrets.GITHUB_TOKEN }}" | docker login --username syntassodev --password-stdin ghcr.io
          echo "${{ secrets.GITHUB_TOKEN }}" | docker login --username syntassodev --password-stdin registry.syntasso.io
      - name: Build and push SKE at next RC
        run: |
          ./script/push-ske-rc-images.sh